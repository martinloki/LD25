<!doctype html>
<html>
	<head>
		<title>Granny's Gummies - LD25</title>
		<link href="/stylesheets/LD25.css" media="all" rel="stylesheet" type="text/css"/>
		<script language="javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js" type="text/javascript"></script>
	</head>
	<body>
		<h1>Granny's Gummies</h1>
		<!--<img id="background" src="images/background.png" alt="floorplan" width="800" height="600">-->
		<script type='text/javascript'>
			var CANVAS_WIDTH=800;
			var CANVAS_HEIGHT=600;
			var FPS=30;
			var textX=50;
			var textY=50;
			
			var canvasElement=$("<canvas width='"+CANVAS_WIDTH+"' height='"+CANVAS_HEIGHT+"' style='border:1px solid #000000;'></canvas>");
			var canvas=canvasElement.get(0).getContext("2d");
			
			var bg_image = new Image();
			var kid_image = new Image();
			
			var KID_RADIUS=30;
			
			var rooms=[];
			var kids=[];
			
			function Room(Index){
				Index = Index || {};
				Index.width=Index.x1-Index.x0
				Index.height=Index.y1-Index.y0
				Index.centerX=(Index.x0+Index.x1)/2;
				Index.centerY=(Index.y0+Index.y1)/2;
				
				Index.getName = function(){
					return Index.roomName;
				};
				
				Index.getCX = function(){
					return Index.centerX;
				};
				
				Index.getCY = function(){
					return Index.centerY;
				};
				
				Index.getX = function(){
					return Index.x0;
				};
				
				Index.getY = function(){
					return Index.y0;
				};
				
				Index.getWidth = function(){
					return Index.width;
				};
				
				Index.getHeight = function(){
					return Index.height;
				};
				
				Index.draw = function(){
					canvas.fillStyle=Index.thisColor;
					canvas.fillRect(Index.x0,Index.y0,Index.width,Index.height);
				};
				
				return Index;
			};
			
			function Kid(Index){
				Index = Index || {};
				Index.baseVel=10;
				Index.width=KID_RADIUS;
				Index.height=KID_RADIUS;
				Index.energy=Math.random()*25;
				Index.focus=Math.random()*50+25;
				Index.sugar=0;
				Index.crashETA=0;
				Index.timeLeftInRoom=100;
				Index.velX=Index.baseVel*(Index.sugar+1)/10;
				Index.velY=Index.baseVel*(Index.sugar+1)/10;
				Index.currentRoom="tbd";
				
				Index.draw=function(){
					canvas.drawImage(kid_image, Index.x,Index.y);
					canvas.fillStyle=Index.color;
					canvas.fillText(Index.name,Index.x,Index.y);
					
				};
								
				Index.update = function() {
					Index.x+=Index.velX;
					Index.y+=Index.velY;
					Index.timeLeftInRoom-=1
				};
				
				Index.getRoom = function(){
					return Index.currentRoom;
				};
				
				Index.getSugar = function(){
					return Index.sugar;
				};
				
				Index.getName = function(){
					return Index.name;
				};
				
				Index.drawPanel = function(x,y){
					canvas.fillText(Index.name,x,y);
					canvas.fillText("Location:",x+15,y+20);
					canvas.fillText("Sugar Level:",x+15,y+30);
					canvas.fillText("Time Left:",x+15,y+40);
					canvas.fillText(Index.currentRoom,x+80,y+20);
					canvas.fillText(Index.sugar,x+80,y+30);
					canvas.fillText(Index.timeLeftInRoom,x+80,y+40);
				};
				
				return Index;				
				
			};
			
			function init(){
				bg_image.src = 'images/background.png';
				kid_image.src = 'images/kid.png';
				
				rooms.push(Room({roomName:"House",			x0:330,y0:0,	x1:667,y1:600,	thisColor:"#FFF"}));
				rooms.push(Room({roomName:"Kid's Room",		x0:330,y0:0,	x1:475,y1:135,	thisColor:"#00F"}));
				rooms.push(Room({roomName:"Kid's Bathroom",	x0:330,y0:135,	x1:475,y1:200,	thisColor:"#0F0"}));
				rooms.push(Room({roomName:"Office",			x0:330,y0:200,	x1:475,y1:335,	thisColor:"#0FF"}));
				rooms.push(Room({roomName:"Kitchen",		x0:330,y0:335,	x1:475,y1:482,	thisColor:"#F00"}));
				rooms.push(Room({roomName:"Dining Room",	x0:330,y0:482,	x1:475,y1:600,	thisColor:"#F0F"}));
				
				rooms.push(Room({roomName:"Parent's Room",		x0:524,y0:0,	x1:667,y1:225,	thisColor:"#FF0"}));
				rooms.push(Room({roomName:"Parent's Bathroom",	x0:524,y0:225,	x1:667,y1:338,	thisColor:"#F55"}));
				rooms.push(Room({roomName:"Living Room",		x0:475,y0:385,	x1:667,y1:600,	thisColor:"#888"}));

				kids.push(Kid({name:"Thing 1",color:"#F0F",x:Math.random()*(rooms[0].getWidth())+rooms[0].getX(),y:Math.random()*(rooms[0].getHeight())+rooms[0].getY()}));
				kids.push(Kid({name:"Thing 2",color:"#0F0",x:Math.random()*(rooms[0].getWidth())+rooms[0].getX(),y:Math.random()*(rooms[0].getHeight())+rooms[0].getY()}));
				
			}
			
			setInterval(function(){
					update();
					draw();
				},1000/FPS
			);

			function update(){
				textX+=1;
				textY+=1;
				kids.forEach(function(kid) {
					kid.update();
				});
			}
			
			function draw(){
				canvas.clearRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);
				canvas.drawImage(bg_image, 0, 0);
				canvas.fillStyle="#000";
				rooms.forEach(function(room) {
					room.draw()
					canvas.fillStyle="#000";
					canvas.fillText(room.getName(),room.getX()+5,room.getY()+10);
				});
				
				nextPanelX=50;
				nextPanelY=50;
				kids.forEach(function(kid) {		
						kid.draw();
						kid.drawPanel(nextPanelX,nextPanelY);
						nextPanelY+=150;
				});               
			}

			init()
			canvasElement.appendTo('body');
			
		</script>
	</body>
</html>